version: '3.8'

services:
  # Backend Service (Node.js API)
  backend:
    build:./backend
    container_name: mts-backend
    restart: always
    # ports:           <-- BU KISIM KALDIRILDI (Gereksiz ve Güvensiz)
    #   - "5000:5000"  <-- API'ye erişim için Coolify panelinden domain atayacaksınız (örn: api.siteniz.com)
    environment:
      - PORT=5000
      - MONGODB_URI=mongodb://mongo:27017/mts_db
      - JWT_SECRET=${JWT_SECRET} # Güvenlik için değişkeni Coolify panelinden girin
      # CORS ayarını production domaininize göre güncellemeyi unutmayın
      - CORS_ORIGIN=https://mts.siteniz.com
    depends_on:
      - mongo

  # Frontend Service (React + Nginx)
  frontend:
    build: 
      context:./frontend
      args:
        - VITE_API_URL=/api
    container_name: mts-frontend
    restart: always
    # ports:       <-- HATAYI ÇÖZEN KISIM (Bu satır silindi)
    #   - "80:80"  <-- Coolify trafiği otomatik yönlendirecek
    expose:
      - 80         # Coolify'ın hangi portu dinleyeceğini bilmesi için (Opsiyonel ama iyi pratik)
    depends_on:
      - backend

  # Database Service (MongoDB)
  mongo:
    image: mongo:latest
    container_name: mts-mongo
    restart: always
    # ports:             <-- GÜVENLİK İÇİN KALDIRILDI
    #   - "27017:27017"  <-- Veritabanını tüm internete açmak çok tehlikelidir!
    volumes:
      - mongo-data:/data/db

volumes:
  mongo-data:
